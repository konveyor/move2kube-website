---
layout: default
title: Transformer
permalink: /documentation/concepts/transformer/
parent: Concepts
grand_parent: Documentation
nav_order: 3
---

# Transformer

[Example built-in transformers](https://github.com/konveyor/move2kube/tree/dcf8793a889c0a8f9f4423e9e9ee3a95003c6bcc/transformer)

## Planning phase

This phase is started by running the `move2kube plan -s path/to/source/directory` command.

During this phase Move2Kube runs all the transformers on the source directory to come up with a plan. The plan is written to a file called `m2k.plan` in YAML format.
Later during the transformation phase Move2Kube will use this plan to transform the source files into the desired output.
The plan file is human readable and can be editted manually to change what transformations are done during the transformation phase.

The plan file contains the list of services that Move2Kube found inside the source directory, including the path to the sub-directories/files where it detected those services.
It also contains a list of all the built-in and external transformers that were detected. These will be run during the transformation phase.
If you write a custom transformer and provide it during the plan phase then you can affect the contents of the plan file.

## Transformation phase

This phase is started by running the `move2kube transform` command.

Move2Kube evaluates which transformers to run in an iterative manner. Each iteration Move2Kube will evaluate the list of artifacts produced during the previous iteration and run all transformers that consume those artifact types. This continues until it hits an iteration where there are no more artifacts or no more transformers that consume those artifact types. At this point the transformation phase is finished.

## Transformer interface

[Source code](https://github.com/konveyor/move2kube/blob/dcf8793a889c0a8f9f4423e9e9ee3a95003c6bcc/transformer/transformer.go#L53-L60)

```golang
// Transformer interface defines transformer that transforms files and converts it to ir representation
type Transformer interface {
	Init(tc transformertypes.Transformer, env *environment.Environment) (err error)
	// GetConfig returns the transformer config
	GetConfig() (transformertypes.Transformer, *environment.Environment)
	DirectoryDetect(dir string) (services map[string][]transformertypes.Artifact, err error)
	Transform(newArtifacts []transformertypes.Artifact, alreadySeenArtifacts []transformertypes.Artifact) ([]transformertypes.PathMapping, []transformertypes.Artifact, error)
}
```

This is the interface all transformers are expected to implement.

- The major function that needs to be implemented is `Transform`.
- If you want your transformer to do something during the planning phase then you can implement `DirectoryDetect` as well. If implement this function, be sure to set
	`directoryDetect` to a value other than `0` in the transformer YAML as well. See [transformer-yaml](/documentation/concepts/transformer-yaml) for more details.
- The `Init` and `GetConfig` functions are fixed and cannot be implemented by custom transformers. They are implemented by transformers built into Move2Kube.

### Methods

- `Init` : `(Transformer, Environment) -> (error)` - TODO

- `GetConfig` : `(Transformer, Environment) -> ()` - TODO

- `DirectoryDetect` : `(string) -> (object ([string]: []Artifact), error)` - This function is called during the planning phase. It is passed the path of a directory containing the source files and it returns a list of artifacts. These artifacts will be listed in the plan file generated by Move2Kube. It can also return an error to signal that something went wrong during the planning.
	- The input is a string containing the path to a directory with source files. This could be the source directory itself or a sub-directory.
		The list of directories/sub-directories that are passed to this function depend on the value of `directoryDetect` in the transformer YAML.
		A value of `-1` for `directoryDetect` will cause this function to be run on the source directory and all of its sub-directories.
		A value of `0` for `directoryDetect` will disable this function entirely (it will not be run on any directories).
		A value of `1` for `directoryDetect` will cause this function to be run only on the source directory but not on of its sub-directories.
	- The output is a list of artifacts. These will be included in the plan file.

- `Transform` : `([]Artifact, []Artifact) -> ([]PathMapping, []Artifact, error)` - This function is called during the transformation phase. It contains the code to do the actual transformation and produce (part of) the output of Move2Kube. The path mappings returned by this function cause changes to the output of Move2Kube. The artifacts returned by this function will be passed to other transformers during the next iteration. It can also return an error to signal that something went wrong during the transformation.
	- The first input is a list of new artifacts produced during the previous iteration.
	- The second input is a list of artifacts that the transformer has already seen.
	- The first output is a list of path mappings. A path mapping is a way for transformers to add files to the output directory of Move2Kube.
		Path mappings can be used to generate new files, delete exiting files, modify the output directory structure, etc.
		See [Path Mapping](/documentation/concepts/path-mapping) for details.
