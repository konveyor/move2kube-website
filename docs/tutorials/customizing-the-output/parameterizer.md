---
layout: default
title: "Parameterizering specific fields in the Helm Chart"
permalink: /tutorials/customizing-the-output/parameterizer
parent: "Customizing the output"
grand_parent: Tutorials
nav_order: 3
---

# Parameterizering specific fields in the Helm Chart

## Big picture

In this example, we illustrate how we could parameterize a value in the helm chart generated by Move2Kube. 

1. Let us start by creating a workspace directory `WORKSPACE_DIR`. We will assume all commands are run within this workspace and all sub-directories are created within this workspace.

2. To dump the input at an accessible location, create an input sub-directory `input` and copy the `e2e-demo` into this folder.

3. To see what we get **without** any customization, let us run `move2kube transform -s input/ --qa-skip`. The relevant snippet from the deployment yaml generated in the path  `myproject/deploy/yamls-parameterized/helm-chart/myproject/templates/config-utils-deployment.yaml` looks like this:
```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
    annotations:
        move2kube.konveyor.io/service.expose: "true"
    creationTimestamp: null
    labels:
        move2kube.konveyor.io/service: config-utils
    name: config-utils
spec:
    progressDeadlineSeconds: 600
    replicas: 2
```

Let us say, we want to parameterize the `replicas` field (see `spec` section) in the above yaml so that we could modify the value at one place in the `values.yaml` to change it all the files (e.g. deployment yamls of all services) in the helm chart which use the `replicas` field. This can be achieved by customizing Move2Kube using custom transformer that is available in [here](https://github.com/konveyor/move2kube-transformers/tree/main/parameterizers/simple-example/).

4. To use this custom transformer, create a `customizations` sub-directory and copy the contents from [here](https://github.com/konveyor/move2kube-transformers/tree/main/parameterizers/simple-example/) into this folder.

5. Run the following CLI command: `move2kube transform -s input/ -c customizations/ --qa-skip`. Note that this command has a `-c customizations/` option which is meant to tell Move2Kube to pick up the custom transformer. 

Once the output is generated, we can observe the same deployment mentioned before i.e. `myproject/deploy/yamls-parameterized/helm-chart/myproject/templates/config-utils-deployment.yaml` contains the parameterized `replicas` field (see `{% raw %} replicas: {{ index .Values "common" "replicas" }} {% endraw %}` in the `spec` section). A snippet of the contents is shown below:
```yaml
{% raw %}apiVersion: apps/v1
kind: Deployment
metadata:
    annotations:
        move2kube.konveyor.io/service.expose: "true"
    creationTimestamp: null
    labels:
        move2kube.konveyor.io/service: config-utils
    name: config-utils
spec:
    progressDeadlineSeconds: 600
    replicas: {{ index .Values "common" "replicas" }}
{% endraw %}
```
The default value of the parameterized field can be see in the `deploy/yamls-parameterized/helm-chart/myproject/values-dev.yaml` file as shown below:

```yaml
common:
  replicas: 10
```

## Anatomy of the parameterizer
The contents of parameterizer are as shown below:
```
├── parameterizers.yaml
└── replicas-parameterizer.yaml
```
The `parameterizers.yaml` is the configuration for the transformer. As can be seen from the contents below, the name of our custom transformer is `CustomParameterizers` (see `name` field in the `metadata` section). In the specification section, let us look at the important fields of interest:
- Specifying that we are going to use an in-built transformer class (see `class` field in `spec` section) `Parameterizer` as the basis of our transformer (Note here that there could different **transformers** implementing the same **transformer class**. The difference could be in the way they are configured.)
- we are asking Move2Kube to pass artifacts of type `KubernetesYamls` to this transformer (see `consumes` field).
- We are also specifying an `override` section which is asking Move2Kube to override the in-built transformer named `Parameterizer` and use our custom transformer in its place.

```yaml
{% raw %}apiVersion: move2kube.konveyor.io/v1alpha1
kind: Transformer
metadata:
  name: CustomParameterizers
  labels: 
    move2kube.konveyor.io/inbuilt: false
spec:
  class: "Parameterizer"
  directoryDetect:
    levels: 0
  consumes:
    KubernetesYamls:
      merge: true
  override:
    matchLabels: 
      move2kube.konveyor.io/name: Parameterizer
  config:
    helmPath: "{{ OutputRel .YamlsPath }}/../{{ FilePathBase .YamlsPath }}-parameterized/helm-chart"
    ocTemplatePath: "{{ OutputRel .YamlsPath }}/../{{ FilePathBase .YamlsPath }}-parameterized/openshift-template"
    kustomizePath: "{{ OutputRel .YamlsPath }}/../{{ FilePathBase .YamlsPath }}-parameterized/kustomize"
    helmChartName: "{{ .ProjectName }}"
{% endraw %}
```

The contents of the `replicas-parameterizer.yaml` file is shown below.  This file describes the target fields to be parameterized (`target` in the `spec` section), template (`template`) to be used to replace the target field, default value (in this example, `default` is set to 10) to be used for the target field, and which type of files (`filters`) need to be modified.

```yaml
apiVersion: move2kube.konveyor.io/v1alpha1
kind: Parameterizer
metadata:
  name: replicas-parameterizer
spec:
  parameterizers:
    - target: "spec.replicas"
      template: "${common.replicas}"
      default: 10
      filters:
        - kind: Deployment
          apiVersion: ".*/v1.*"
```

Next step [Customizing the output directory structure](/tutorials/customizing-the-output/output-directory-structure)
