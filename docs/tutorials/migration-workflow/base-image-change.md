---
layout: default
title: "Custom transformer for base-image-change"
permalink: /tutorials/migration-workflow/base-image-change
parent: "Migration workflow"
grand_parent: Tutorials
nav_order: 4
---

# Changing the base image of the dockerfile

## Big picture

In this example, we illustrate how we could include our own custom base image into the dockerfile generated by Move2Kube. 

1. Let us start by creating a workspace directory `WORKSPACE_DIR`. We will assume all commands are run within this workspace and all sub-directories are created within this workspace.

2. To dump the input at an accessible location, create an input sub-directory `input` and copy the `e2e-demo` into this folder.

3. To see what we get **without** any customization, let us run `move2kube transform -s input/ --qa-skip`. The output dockerfile generated in the path  `myproject/source/e2e-demo/frontend/Dockerfile` looks like this:
```
FROM registry.access.redhat.com/ubi8/nodejs-12
COPY . .
RUN npm install
RUN npm run build
EXPOSE 8080
CMD npm run start
```

Let us say, we want to change the base image `registry.access.redhat.com/ubi8/nodejs-12` provided by Move2Kube, to some custom image, say `quay.io/padmanabhavs/nodejs-12`. This can be achieved by customizing Move2Kube using custom transformer that is available in [here](https://github.com/konveyor/move2kube-transformers/tree/main/base-image-change).

4. To use this custom transformer, create a `customizations` sub-directory and copy the `base-image-change` from [here](https://github.com/konveyor/move2kube-transformers/tree/main/base-image-change) into this folder.

5. Run the following CLI command: `move2kube transform -s input/ -c customizations/ --qa-skip`. Note that this command has a `-c customizations/` option which is meant to tell Move2Kube to pick up the custom transformer `base-image-change`. 

Once the output is generated, we can observe the same dockerfile mentioned before i.e. `myproject/source/e2e-demo/frontend/Dockerfile` contains the custom image. The contents are shown below:
```
FROM quay.io/padmanabhavs/nodejs-12
COPY . .
RUN npm install
RUN npm run build
EXPOSE 8080
CMD npm run start

```

## Anatomy of `base-image-change` transformer
Specifically, the `base-image-change` transformer is generating a custom dockerfile for any NodeJS service detected within `e2e-demo` project.
The contents of `base-image-change` are as shown below:
```
base-image-change/
├── nodejs.yaml
└── templates
    └── Dockerfile
```
The `nodejs.yaml` is the configuration for the transformer. As can be seen from the contents below, the name of our custom transformer is `Nodejs-ChangeBaseImage` (see `name` field in the `metadata` section). In the specification section, let us look at the important fields of interest:
- Specifying that we are going to use an in-built transformer class (see `class` field in `spec` section) `NodejsDockerfileGenerator` as the basis of our transformer (Note here that there could different **transformers** implementing the same **transformer class**. The difference could be in the way they are configured.)
- we are asking Move2Kube to pass artifacts of type `Service` to this transformer (see `consumes` field).
- we are stating that the output produced by this transformer is a `Dockerfile` (see `produce` field). 
- We are also specifying an `override` section which is asking Move2Kube to override the in-built transformer named `Nodejs-Dockerfile` and use our custom transformer in its place.
```
apiVersion: move2kube.konveyor.io/v1alpha1
kind: Transformer
metadata:
  name: Nodejs-ChangeBaseImage
  labels:
    move2kube.konveyor.io/task: containerization
    move2kube.konveyor.io/inbuilt: true
spec:
  class: "NodejsDockerfileGenerator"
  directoryDetect:
    levels: -1
  consumes:
    Service: 
      merge: false
  produces:
    Dockerfile:
      disabled: false
    DockerfileForService:
      disabled: false
  override:
    matchLabels: 
      move2kube.konveyor.io/name: Nodejs-Dockerfile
  config:
    defaultNodejsVersion: "12"
```
Next step [Custom transformer 2](/tutorials/migration-workflow/custom-transformer-2)
