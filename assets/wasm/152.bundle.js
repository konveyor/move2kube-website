"use strict";(self.webpackChunkmove2kube_wasm=self.webpackChunkmove2kube_wasm||[]).push([[152],{152:(t,e,r)=>{r.d(e,{__:()=>b,Fd:()=>h,ZH:()=>w,xy:()=>y,bJ:()=>c});const n=58;class s{static read_bytes(t,e){const r=new s;return r.buf=t.getUint32(e,!0),r.buf_len=t.getUint32(e+4,!0),r}static read_bytes_array(t,e,r){const n=[];for(let i=0;i<r;i++)n.push(s.read_bytes(t,e+8*i));return n}}class i{static read_bytes(t,e){const r=new i;return r.buf=t.getUint32(e,!0),r.buf_len=t.getUint32(e+4,!0),r}static read_bytes_array(t,e,r){const n=[];for(let s=0;s<r;s++)n.push(i.read_bytes(t,e+8*s));return n}}class f{head_length(){return 24}name_length(){return this.dir_name.byteLength}write_head_bytes(t,e){t.setBigUint64(e,this.d_next,!0),t.setBigUint64(e+8,this.d_ino,!0),t.setUint32(e+16,this.dir_name.length,!0),t.setUint8(e+20,this.d_type)}write_name_bytes(t,e,r){t.set(this.dir_name.slice(0,Math.min(this.dir_name.byteLength,r)),e)}constructor(t,e,r){this.d_ino=1n;const n=(new TextEncoder).encode(e);this.d_next=t,this.d_namlen=n.byteLength,this.d_type=r,this.dir_name=n}}class a{write_bytes(t,e){t.setUint8(e,this.fs_filetype),t.setUint16(e+2,this.fs_flags,!0),t.setBigUint64(e+8,this.fs_rights_base,!0),t.setBigUint64(e+16,this.fs_rights_inherited,!0)}constructor(t,e){this.fs_rights_base=0n,this.fs_rights_inherited=0n,this.fs_filetype=t,this.fs_flags=e}}class o{write_bytes(t,e){t.setBigUint64(e,this.dev,!0),t.setBigUint64(e+8,this.ino,!0),t.setUint8(e+16,this.filetype),t.setBigUint64(e+24,this.nlink,!0),t.setBigUint64(e+32,this.size,!0),t.setBigUint64(e+38,this.atim,!0),t.setBigUint64(e+46,this.mtim,!0),t.setBigUint64(e+52,this.ctim,!0)}constructor(t,e){this.dev=0n,this.ino=0n,this.nlink=0n,this.atim=0n,this.mtim=0n,this.ctim=0n,this.filetype=t,this.size=e}}class l{write_bytes(t,e){t.setUint32(e,this.pr_name_len,!0)}constructor(t){this.pr_name_len=t}}class d{static dir(t){const e=new d;return e.tag=0,e.inner=new l(t),e}write_bytes(t,e){t.setUint32(e,this.tag,!0),this.inner.write_bytes(t,e+4)}}const _=new class{enable(t){this.log=function(t,e){return t?console.log.bind(console,"%c%s","color: #265BA0",e):()=>{}}(void 0===t||t,this.prefix)}get enabled(){return this.isEnabled}constructor(t){this.isEnabled=t,this.prefix="wasi:",this.enable(t)}}(!1);class u extends Error{constructor(t){super("exit with exit code "+t),this.code=t}}let c=class{start(t){this.inst=t;try{return t.exports._start(),0}catch(t){if(t instanceof u)return t.code;throw t}}initialize(t){this.inst=t,t.exports._initialize()}constructor(t,e,r,n={}){this.args=[],this.env=[],this.fds=[],_.enable(n.debug),this.args=t,this.env=e,this.fds=r;const f=this;this.wasiImport={args_sizes_get(t,e){const r=new DataView(f.inst.exports.memory.buffer);r.setUint32(t,f.args.length,!0);let n=0;for(const t of f.args)n+=t.length+1;return r.setUint32(e,n,!0),_.log(r.getUint32(t,!0),r.getUint32(e,!0)),0},args_get(t,e){const r=new DataView(f.inst.exports.memory.buffer),n=new Uint8Array(f.inst.exports.memory.buffer),s=e;for(let s=0;s<f.args.length;s++){r.setUint32(t,e,!0),t+=4;const i=(new TextEncoder).encode(f.args[s]);n.set(i,e),r.setUint8(e+i.length,0),e+=i.length+1}return _.enabled&&_.log(new TextDecoder("utf-8").decode(n.slice(s,e))),0},environ_sizes_get(t,e){const r=new DataView(f.inst.exports.memory.buffer);r.setUint32(t,f.env.length,!0);let n=0;for(const t of f.env)n+=t.length+1;return r.setUint32(e,n,!0),_.log(r.getUint32(t,!0),r.getUint32(e,!0)),0},environ_get(t,e){const r=new DataView(f.inst.exports.memory.buffer),n=new Uint8Array(f.inst.exports.memory.buffer),s=e;for(let s=0;s<f.env.length;s++){r.setUint32(t,e,!0),t+=4;const i=(new TextEncoder).encode(f.env[s]);n.set(i,e),r.setUint8(e+i.length,0),e+=i.length+1}return _.enabled&&_.log(new TextDecoder("utf-8").decode(n.slice(s,e))),0},clock_res_get(t,e){let r;switch(t){case 1:r=5000n;break;case 0:r=1000000n;break;default:return 52}return new DataView(f.inst.exports.memory.buffer).setBigUint64(e,r,!0),0},clock_time_get(t,e,r){const n=new DataView(f.inst.exports.memory.buffer);if(0===t)n.setBigUint64(r,1000000n*BigInt((new Date).getTime()),!0);else if(1==t){let t;try{t=BigInt(Math.round(1e6*performance.now()))}catch(e){t=0n}n.setBigUint64(r,t,!0)}else n.setBigUint64(r,0n,!0);return 0},fd_advise:(t,e,r,n)=>null!=f.fds[t]?f.fds[t].fd_advise(e,r,n):8,fd_allocate:(t,e,r)=>null!=f.fds[t]?f.fds[t].fd_allocate(e,r):8,fd_close(t){if(null!=f.fds[t]){const e=f.fds[t].fd_close();return f.fds[t]=void 0,e}return 8},fd_datasync:t=>null!=f.fds[t]?f.fds[t].fd_datasync():8,fd_fdstat_get(t,e){if(null!=f.fds[t]){const{ret:r,fdstat:n}=f.fds[t].fd_fdstat_get();return null!=n&&n.write_bytes(new DataView(f.inst.exports.memory.buffer),e),r}return 8},fd_fdstat_set_flags:(t,e)=>null!=f.fds[t]?f.fds[t].fd_fdstat_set_flags(e):8,fd_fdstat_set_rights:(t,e,r)=>null!=f.fds[t]?f.fds[t].fd_fdstat_set_rights(e,r):8,fd_filestat_get(t,e){if(null!=f.fds[t]){const{ret:r,filestat:n}=f.fds[t].fd_filestat_get();return null!=n&&n.write_bytes(new DataView(f.inst.exports.memory.buffer),e),r}return 8},fd_filestat_set_size:(t,e)=>null!=f.fds[t]?f.fds[t].fd_filestat_set_size(e):8,fd_filestat_set_times:(t,e,r,n)=>null!=f.fds[t]?f.fds[t].fd_filestat_set_times(e,r,n):8,fd_pread(t,e,r,n,i){const a=new DataView(f.inst.exports.memory.buffer),o=new Uint8Array(f.inst.exports.memory.buffer);if(null!=f.fds[t]){const l=s.read_bytes_array(a,e,r),{ret:d,nread:_}=f.fds[t].fd_pread(o,l,n);return a.setUint32(i,_,!0),d}return 8},fd_prestat_get(t,e){const r=new DataView(f.inst.exports.memory.buffer);if(null!=f.fds[t]){const{ret:n,prestat:s}=f.fds[t].fd_prestat_get();return null!=s&&s.write_bytes(r,e),n}return 8},fd_prestat_dir_name(t,e,r){if(null!=f.fds[t]){const{ret:r,prestat_dir_name:n}=f.fds[t].fd_prestat_dir_name();return null!=n&&new Uint8Array(f.inst.exports.memory.buffer).set(n,e),r}return 8},fd_pwrite(t,e,r,n,s){const a=new DataView(f.inst.exports.memory.buffer),o=new Uint8Array(f.inst.exports.memory.buffer);if(null!=f.fds[t]){const l=i.read_bytes_array(a,e,r),{ret:d,nwritten:_}=f.fds[t].fd_pwrite(o,l,n);return a.setUint32(s,_,!0),d}return 8},fd_read(t,e,r,n){const i=new DataView(f.inst.exports.memory.buffer),a=new Uint8Array(f.inst.exports.memory.buffer);if(null!=f.fds[t]){const o=s.read_bytes_array(i,e,r),{ret:l,nread:d}=f.fds[t].fd_read(a,o);return i.setUint32(n,d,!0),l}return 8},fd_readdir(t,e,r,n,s){const i=new DataView(f.inst.exports.memory.buffer),a=new Uint8Array(f.inst.exports.memory.buffer);if(null!=f.fds[t]){let o=0;for(;;){const{ret:l,dirent:d}=f.fds[t].fd_readdir_single(n);if(0!=l)return i.setUint32(s,o,!0),l;if(null==d)break;if(r-o<d.head_length()){o=r;break}const _=new ArrayBuffer(d.head_length());if(d.write_head_bytes(new DataView(_),0),a.set(new Uint8Array(_).slice(0,Math.min(_.byteLength,r-o)),e),e+=d.head_length(),o+=d.head_length(),r-o<d.name_length()){o=r;break}d.write_name_bytes(a,e,r-o),e+=d.name_length(),o+=d.name_length(),n=d.d_next}return i.setUint32(s,o,!0),0}return 8},fd_renumber(t,e){if(null!=f.fds[t]&&null!=f.fds[e]){const r=f.fds[e].fd_close();return 0!=r?r:(f.fds[e]=f.fds[t],f.fds[t]=void 0,0)}return 8},fd_seek(t,e,r,n){const s=new DataView(f.inst.exports.memory.buffer);if(null!=f.fds[t]){const{ret:i,offset:a}=f.fds[t].fd_seek(e,r);return s.setBigInt64(n,a,!0),i}return 8},fd_sync:t=>null!=f.fds[t]?f.fds[t].fd_sync():8,fd_tell(t,e){const r=new DataView(f.inst.exports.memory.buffer);if(null!=f.fds[t]){const{ret:n,offset:s}=f.fds[t].fd_tell();return r.setBigUint64(e,s,!0),n}return 8},fd_write(t,e,r,n){const s=new DataView(f.inst.exports.memory.buffer),a=new Uint8Array(f.inst.exports.memory.buffer);if(null!=f.fds[t]){const o=i.read_bytes_array(s,e,r),{ret:l,nwritten:d}=f.fds[t].fd_write(a,o);return s.setUint32(n,d,!0),l}return 8},path_create_directory(t,e,r){const n=new Uint8Array(f.inst.exports.memory.buffer);if(null!=f.fds[t]){const s=new TextDecoder("utf-8").decode(n.slice(e,e+r));return f.fds[t].path_create_directory(s)}},path_filestat_get(t,e,r,n,s){const i=new DataView(f.inst.exports.memory.buffer),a=new Uint8Array(f.inst.exports.memory.buffer);if(null!=f.fds[t]){const o=new TextDecoder("utf-8").decode(a.slice(r,r+n)),{ret:l,filestat:d}=f.fds[t].path_filestat_get(e,o);return null!=d&&d.write_bytes(i,s),l}return 8},path_filestat_set_times(t,e,r,n,s,i,a){const o=new Uint8Array(f.inst.exports.memory.buffer);if(null!=f.fds[t]){const l=new TextDecoder("utf-8").decode(o.slice(r,r+n));return f.fds[t].path_filestat_set_times(e,l,s,i,a)}return 8},path_link(t,e,r,n,s,i,a){const o=new Uint8Array(f.inst.exports.memory.buffer);if(null!=f.fds[t]&&null!=f.fds[s]){const l=new TextDecoder("utf-8").decode(o.slice(r,r+n)),d=new TextDecoder("utf-8").decode(o.slice(i,i+a));return f.fds[s].path_link(t,e,l,d)}return 8},path_open(t,e,r,n,s,i,a,o,l){const d=new DataView(f.inst.exports.memory.buffer),u=new Uint8Array(f.inst.exports.memory.buffer);if(null!=f.fds[t]){const c=new TextDecoder("utf-8").decode(u.slice(r,r+n));_.log(c);const{ret:h,fd_obj:p}=f.fds[t].path_open(e,c,s,i,a,o);if(0!=h)return h;f.fds.push(p);const g=f.fds.length-1;return d.setUint32(l,g,!0),0}return 8},path_readlink(t,e,r,n,s,i){const a=new DataView(f.inst.exports.memory.buffer),o=new Uint8Array(f.inst.exports.memory.buffer);if(null!=f.fds[t]){const l=new TextDecoder("utf-8").decode(o.slice(e,e+r));_.log(l);const{ret:d,data:u}=f.fds[t].path_readlink(l);if(null!=u){const t=(new TextEncoder).encode(u);if(t.length>s)return a.setUint32(i,0,!0),8;o.set(t,n),a.setUint32(i,t.length,!0)}return d}return 8},path_remove_directory(t,e,r){const n=new Uint8Array(f.inst.exports.memory.buffer);if(null!=f.fds[t]){const s=new TextDecoder("utf-8").decode(n.slice(e,e+r));return f.fds[t].path_remove_directory(s)}return 8},path_rename(t,e,r,n,s,i){throw"FIXME what is the best abstraction for this?"},path_symlink(t,e,r,n,s){const i=new Uint8Array(f.inst.exports.memory.buffer);if(null!=f.fds[r]){const a=new TextDecoder("utf-8").decode(i.slice(t,t+e)),o=new TextDecoder("utf-8").decode(i.slice(n,n+s));return f.fds[r].path_symlink(a,o)}return 8},path_unlink_file(t,e,r){const n=new Uint8Array(f.inst.exports.memory.buffer);if(null!=f.fds[t]){const s=new TextDecoder("utf-8").decode(n.slice(e,e+r));return f.fds[t].path_unlink_file(s)}return 8},poll_oneoff(t,e,r){throw"async io not supported"},proc_exit(t){throw new u(t)},proc_raise(t){throw"raised signal "+t},sched_yield(){},random_get(t,e){const r=new Uint8Array(f.inst.exports.memory.buffer);for(let n=0;n<e;n++)r[t+n]=256*Math.random()|0},sock_recv(t,e,r){throw"sockets not supported"},sock_send(t,e,r){throw"sockets not supported"},sock_shutdown(t,e){throw"sockets not supported"},sock_accept(t,e){throw"sockets not supported"}}}};class h{fd_advise(t,e,r){return n}fd_allocate(t,e){return n}fd_close(){return 0}fd_datasync(){return n}fd_fdstat_get(){return{ret:n,fdstat:null}}fd_fdstat_set_flags(t){return n}fd_fdstat_set_rights(t,e){return n}fd_filestat_get(){return{ret:n,filestat:null}}fd_filestat_set_size(t){return n}fd_filestat_set_times(t,e,r){return n}fd_pread(t,e,r){return{ret:n,nread:0}}fd_prestat_get(){return{ret:n,prestat:null}}fd_prestat_dir_name(){return{ret:n,prestat_dir_name:null}}fd_pwrite(t,e,r){return{ret:n,nwritten:0}}fd_read(t,e){return{ret:n,nread:0}}fd_readdir_single(t){return{ret:n,dirent:null}}fd_seek(t,e){return{ret:n,offset:0n}}fd_sync(){return 0}fd_tell(){return{ret:n,offset:0n}}fd_write(t,e){return{ret:n,nwritten:0}}path_create_directory(t){return n}path_filestat_get(t,e){return{ret:n,filestat:null}}path_filestat_set_times(t,e,r,s,i){return n}path_link(t,e,r,s){return n}path_open(t,e,r,s,i,f){return{ret:n,fd_obj:null}}path_readlink(t){return{ret:n,data:null}}path_remove_directory(t){return n}path_rename(t,e,r){return n}path_symlink(t,e){return n}path_unlink_file(t){return n}}class p extends h{fd_fdstat_get(){return{ret:0,fdstat:new a(4,0)}}fd_read(t,e){let r=0;for(const n of e){if(!(this.file_pos<this.file.data.byteLength))break;{const e=this.file.data.slice(Number(this.file_pos),Number(this.file_pos+BigInt(n.buf_len)));t.set(e,n.buf),this.file_pos+=BigInt(e.length),r+=e.length}}return{ret:0,nread:r}}fd_pread(t,e,r){let n=0;for(const s of e){if(!(r<this.file.data.byteLength))break;{const e=this.file.data.slice(Number(r),Number(r+BigInt(s.buf_len)));t.set(e,s.buf),r+=BigInt(e.length),n+=e.length}}return{ret:0,nread:n}}fd_seek(t,e){let r;switch(e){case 0:r=t;break;case 1:r=this.file_pos+t;break;case 2:r=BigInt(this.file.data.byteLength)+t;break;default:return{ret:28,offset:0n}}return r<0?{ret:28,offset:0n}:(this.file_pos=r,{ret:0,offset:this.file_pos})}fd_tell(){return{ret:0,offset:this.file_pos}}fd_write(t,e){let r=0;if(this.file.readonly)return{ret:8,nwritten:r};for(const n of e){const e=t.slice(n.buf,n.buf+n.buf_len);if(this.file_pos+BigInt(e.byteLength)>this.file.size){const t=this.file.data;this.file.data=new Uint8Array(Number(this.file_pos+BigInt(e.byteLength))),this.file.data.set(t)}this.file.data.set(e.slice(0,Number(this.file.size-this.file_pos)),Number(this.file_pos)),this.file_pos+=BigInt(e.byteLength),r+=n.buf_len}return{ret:0,nwritten:r}}fd_pwrite(t,e,r){let n=0;if(this.file.readonly)return{ret:8,nwritten:n};for(const s of e){const e=t.slice(s.buf,s.buf+s.buf_len);if(r+BigInt(e.byteLength)>this.file.size){const t=this.file.data;this.file.data=new Uint8Array(Number(r+BigInt(e.byteLength))),this.file.data.set(t)}this.file.data.set(e.slice(0,Number(this.file.size-r)),Number(r)),r+=BigInt(e.byteLength),n+=s.buf_len}return{ret:0,nwritten:n}}fd_filestat_get(){return{ret:0,filestat:this.file.stat()}}constructor(t){super(),this.file_pos=0n,this.file=t}}class g extends h{fd_fdstat_get(){return{ret:0,fdstat:new a(3,0)}}fd_readdir_single(t){if(_.enabled&&(_.log("readdir_single",t),_.log(t,Object.keys(this.dir.contents))),_.log(t,Object.keys(this.dir.contents).slice(Number(t))),t>=BigInt(Object.keys(this.dir.contents).length))return{ret:0,dirent:null};const e=Object.keys(this.dir.contents)[Number(t)],r=this.dir.contents[e];return{ret:0,dirent:new f(t+1n,e,r.stat().filetype)}}path_filestat_get(t,e){const r=this.dir.get_entry_for_path(e);return null==r?{ret:44,filestat:null}:{ret:0,filestat:r.stat()}}path_open(t,e,r,n,s,i){let f=this.dir.get_entry_for_path(e);if(null==f){if(1!=(1&r))return{ret:44,fd_obj:null};f=this.dir.create_entry_for_path(e,2==(2&r))}else if(4==(4&r))return{ret:20,fd_obj:null};if(2==(2&r)&&3!==f.stat().filetype)return{ret:54,fd_obj:null};if(f.readonly&&(n&BigInt(64))==BigInt(64))return{ret:63,fd_obj:null};if(!(f instanceof b)&&8==(8&r)){const t=f.truncate();if(0!=t)return{ret:t,fd_obj:null}}return{ret:0,fd_obj:f.open(i)}}path_create_directory(t){return this.path_open(0,t,3,0n,0n,0).ret}path_unlink_file(t){t=this.clean_path(t);const e=this.dir.get_parent_dir_for_path(t),r=t.split("/"),n=r[r.length-1],s=this.dir.get_entry_for_path(t);return null===s?44:3===s.stat().filetype?31:(delete e.contents[n],0)}path_remove_directory(t){t=this.clean_path(t);const e=this.dir.get_parent_dir_for_path(t),r=t.split("/"),n=r[r.length-1],s=this.dir.get_entry_for_path(t);return null===s?44:s instanceof b&&3===s.stat().filetype?0!==Object.keys(s.contents).length?55:void 0===e.contents[n]?44:(delete e.contents[n],0):54}clean_path(t){for(;t.length>0&&"/"===t[t.length-1];)t=t.slice(0,t.length-1);return t}constructor(t){super(),this.dir=t}}class y extends g{fd_prestat_get(){return{ret:0,prestat:d.dir(this.prestat_name.length)}}fd_prestat_dir_name(){return{ret:0,prestat_dir_name:this.prestat_name}}constructor(t,e){super(new b(e)),this.prestat_name=(new TextEncoder).encode(t)}}class w{open(t){const e=new p(this);return 1&t&&e.fd_seek(0n,2),e}get size(){return BigInt(this.data.byteLength)}stat(){return new o(4,this.size)}truncate(){return this.readonly?63:(this.data=new Uint8Array([]),0)}constructor(t,e){this.data=new Uint8Array(t),this.readonly=!!e?.readonly}}class b{open(t){return new g(this)}stat(){return new o(3,0n)}get_entry_for_path(t){let e=this;for(const r of t.split("/")){if(""==r)break;if("."!=r){if(!(e instanceof b))return null;if(null==e.contents[r])return _.log(r),null;e=e.contents[r]}}return e}get_parent_dir_for_path(t){if(""===t)return null;let e=this,r=e;for(const n of t.split("/")){if(""===n)break;if("."!==n){if(!(e instanceof b))return _.log(e),null;if(void 0===e.contents[n])return _.log(n),null;r=e,e=e.contents[n]}}return r}create_entry_for_path(t,e){let r=this;const n=t.split("/").filter((t=>"/"!=t));for(let t=0;t<n.length;t++){const s=n[t];if(!(r instanceof b))break;null!=r.contents[s]||(_.log("create",s),t!=n.length-1||e?r.contents[s]=new b({}):r.contents[s]=new w(new ArrayBuffer(0))),r=r.contents[s]}return r}constructor(t){this.readonly=!1,this.contents=t}}}}]);